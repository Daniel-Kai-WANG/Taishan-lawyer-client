<template>
  <div class="contact">
    <div class="contact-container">
      <h2 class="contact-title h2-style">联系我们</h2>
      <Carousel
        :transition="500"
        :itemsToShow="isMobile ? 1 : 3"
        :wrapAround="true"
        :autoplay="3000"
        :paginationEnabled="false"
        :navigationEnabled="false"
        :mouseDrag="true"
        :touchDrag="true"
        class="rotating-chart"
        @update:modelValue="handleSlideChange"
      >
        <Slide v-for="(item, index) in coloredSvgs" :key="item.id">
          <div class="slide-content" :class="{ 'active-slide': index === centerIndex }">
            <div class="slide-icon" v-html="item.svgMarkup"></div>
            <p class="slide-name h6-style">{{ item.contentFirst }}</p>
            <p class="slide-name h6-style">{{ item.contentSecond }}</p>
          </div>
        </Slide>
      </Carousel>
    </div>
  </div>
</template>

<script setup lang="ts">
import { Carousel, Slide } from 'vue3-carousel'
import 'vue3-carousel/dist/carousel.css'
import { ref, reactive, computed, watchEffect } from 'vue'
import useMedia from 'vue-hooks-plus/es/useMedia'

const isMobile = useMedia(['(max-width: 768px)'], [true], false)
const generateSvgMarkup = (svg: string, color: string) => {
  let newSvg = svg.replace(/fill="[^"]+"/g, `fill="${color}"`)
  newSvg = newSvg.replace(/(<path(?!.*?fill=["'])(.*?))/g, `$1 fill="${color}" $2`)
  return newSvg
}

const contactModules = reactive([
  {
    id: 1,
    contentFirst: '联系人： 费先生',
    contentSecond: '电话：18651973679',
    svgMarkup:
      '<svg t="1699965102538" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23553" ><path d="M908.04764 691.466418l-12.631692-16.232706-0.464581-0.493234c-4.123924-4.326539-15.82543-16.231683-34.96228-32.668027-22.883173-19.688411-63.711044-48.726771-66.932412-50.876738l-57.118905-34.496675c-10.483772-5.256724-21.605064-6.358825-29.096688-6.358825-8.131191 0-16.145725 1.306762-23.144116 3.773953-24.710798 8.624425-47.767933 47.565319-54.185087 59.325154-2.963495 5.430686-6.214539 11.935843-9.003048 17.656125l-0.899486 1.801019c-3.484358 6.940063-7.377014 14.721283-11.499915 22.300912-4.066619 7.317663-12.775978 14.751982-21.605064 14.751982-2.728134 0-5.28333-0.668219-7.750521-2.061962-38.274722-21.982664-83.60207-50.438763-129.831974-94.985328-52.1528-50.294476-83.108836-90.047876-100.241029-128.842437-1.044796-2.657526-0.929162-14.693654 5.865591-18.048051 9.379625-4.675486 17.016559-7.738241 23.752983-10.468422l1.568728-0.682545c9.698896-3.934612 18.903535-7.652284 29.386284-14.039761 4.529153-2.918469 6.940063-4.253884 9.002025-5.41636l1.044796-0.623193c3.774977-2.047636 7.317663-4.00829 18.178011-11.32493 0.465604-0.334621 2.439562-1.960655 4.530177-3.746324l6.968715-6.302543c18.207687-17.552771 24.189935-43.38409 15.216563-65.742307l-3.13541-9.045003c-0.058328-0.233314-11.615549-27.122731-30.142507-59.078537-9.002025-15.46318-22.650883-36.023448-34.731012-52.342112-32.638351-44.008306-62.838164-58.077743-62.983473-58.134025-0.319272-0.174985-8.159844-4.341888-12.979616-6.53381-19.688411-8.42181-41.933041-8.117888-61.794391 0.594541-29.676903 11.150968-47.88459 26.366508-67.252707 42.541909l-4.240581 3.628644c-57.496505 48.001247-88.639806 110.62247-81.293491 163.515121 11.021008 79.987752 103.420441 243.256256 223.349881 358.830505 119.871111 115.485221 288.670585 204.25601 371.112226 214.739782 6.243191 0.813528 12.661368 1.219781 19.078521 1.219781 59.557444 0 106.020662-36.32737 139.791813-67.980277 16.84055-15.796778 39.084157-41.84606 50.930973-67.630307C920.361083 749.341546 925.355841 716.353225 908.04764 691.466418M293.157271 468.464461c20.559245 46.505173 55.638181 92.212168 113.657596 148.08264 50.699706 48.929386 100.095719 80.030731 141.765771 103.987353 11.963473 6.822382 24.769127 10.278087 37.953404 10.278087 33.917484 0 61.909002-23.229051 74.687026-46.257533 4.792143-8.741082 9.029654-17.248849 13.675464-26.598798l1.917676-3.947915c2.148943-4.211928 4.093225-8.132214 5.865591-11.472286 9.610892-17.33583 18.759249-27.818579 22.737864-31.419594 1.104147-0.057305 2.670829-0.027629 3.571339 0.060375l50.730405 30.664394 0.841158 0.579191c12.310374 8.798387 42.773176 30.897707 59.849086 45.620014 14.895245 12.777001 24.50716 22.273283 27.64257 25.351388 0.553609 0.578168 0.901533 0.956791 1.251503 1.188058l9.289574 11.907191c0.668219 2.496867 0 11.847839-3.773953 20.123316-8.217149 17.831111-25.206078 37.401842-37.285185 48.727795-38.736233 36.239366-67.921949 51.658544-97.656157 51.658544-3.920286 0-7.986905-0.261966-12.081153-0.813528-63.014172-7.984858-221.591841-87.291089-336.758814-198.246133C256.249687 537.301246 174.100712 384.994398 165.73723 324.522118c-4.41352-31.885198 19.165502-74.512041 60.051701-108.662839l4.384867-3.615341c17.771759-14.94027 29.532617-24.798802 51.049676-32.929993 3.716648-1.567705 6.706749-2.365884 9.204639-2.365884 1.771343 0 3.659343 0.376577 5.285377 1.060145 2.148943 1.016143 5.749958 2.88777 7.956206 4.078899l1.916653 0.973164c0.203638 0.102331 19.572778 10.235109 41.815361 40.260959 11.092639 14.868639 23.231097 33.190937 31.012318 46.607504 8.537444 14.810311 17.046235 31.187303 25.263383 48.697095 0.320295 0.654916 0.581238 1.220804 0.813528 1.671059l2.671852 8.02886c0.203638 0.478907 0.260943 0.740874 0.319272 0.740874-0.116657 0.144286-0.435928 0.477884-0.98749 1.016143l-1.771343 1.755993c-0.754177 0.712221-1.567705 1.481747-2.032286 1.989307-7.695263 5.081739-10.338463 6.532787-13.06762 8.116865-2.671852 1.452071-5.92392 3.238764-12.370749 7.316639-5.982248 3.659343-11.993149 6.098905-20.529569 9.540284-8.450463 3.396353-17.683754 7.202029-29.068036 12.81998C286.769794 391.83213 281.309432 441.735703 293.157271 468.464461" fill="#231F20" p-id="23554"></path></svg>',
  },
  {
    id: 2,
    contentFirst: '经营地址：新北区云河路新桥商务大楼4楼东',
    contentSecond: '注册地址：天宁区尚东花园',
    svgMarkup:
      '<svg t="1699965163793" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="24561"><path d="M753.536 663.552a337.066667 337.066667 0 0 0 0-478.805333c-133.333333-132.565333-349.738667-132.565333-483.072 0a337.066667 337.066667 0 0 0 0 478.805333L512 903.68l241.536-240.128zM210.304 724.096a422.4 422.4 0 0 1 0-599.893333C376.917333-41.386667 647.082667-41.386667 813.653333 124.245333a422.4 422.4 0 0 1 0 599.893334L512 1024l-301.696-299.946667zM512 512a85.333333 85.333333 0 1 0 0-170.666667 85.333333 85.333333 0 0 0 0 170.666667z m0 85.333333a170.666667 170.666667 0 1 1 0-341.333333 170.666667 170.666667 0 0 1 0 341.333333z" fill="#3D3D3D" p-id="24562"></path></svg>',
  },
  {
    id: 3,
    contentFirst: '联系人：费先生',
    contentSecond: '邮箱：963499749@qq.com',
    svgMarkup:
      '<svg t="1699965238791" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="28998"><path d="M906.000638 1023.99996a99.290887 99.290887 0 0 1-57.16748-18.052889L483.763632 746.186063l-55.161604 221.649355a40.11753 40.11753 0 0 1-39.114592 30.088147 40.11753 40.11753 0 0 1-39.114592-31.091086l-82.240937-352.031328a20.058765 20.058765 0 0 0-11.032321-14.041135L50.494306 504.477943l-5.014692-3.008815a100.293826 100.293826 0 0 1 18.052889-176.517133L886.944811 7.020568a100.293826 100.293826 0 0 1 136.399603 101.296764l-17.04995 821.406432v3.008815a99.290887 99.290887 0 0 1-58.170419 81.237998 100.293826 100.293826 0 0 1-42.123407 10.029383z m-11.03232-84.246814a20.058765 20.058765 0 0 0 31.091085-13.038197l17.049951-821.406432v-3.008815a20.058765 20.058765 0 0 0-27.079333-21.061703L92.617712 399.169426a20.058765 20.058765 0 0 0-6.017629 34.099901l203.596466 94.276196a99.290887 99.290887 0 0 1 55.161604 68.199801l45.132222 190.558269 29.085209-117.343776a40.11753 40.11753 0 0 1 62.182172-23.06758z" fill="#396178" p-id="28999"></path><path d="M389.487436 997.923565a40.11753 40.11753 0 0 1-27.079333-69.202739l191.561207-176.517134a40.11753 40.11753 0 0 1 54.158666 59.173358L416.566769 986.891244a40.11753 40.11753 0 0 1-27.079333 11.032321zM462.701929 714.092039a40.11753 40.11753 0 0 1-31.091086-65.190987L917.032959 42.123407a40.11753 40.11753 0 1 1 62.182172 50.146913L493.793015 699.047965a40.11753 40.11753 0 0 1-31.091086 15.044074z" fill="#396178" p-id="29000"></path></svg>',
  },
])

const currentIndex = ref(-1)
const handleSlideChange = (event: any) => {
  currentIndex.value = event - 1
}
const centerIndex = computed(() => {
  return (currentIndex.value + 1) % contactModules.length
})

watchEffect(() => {
  contactModules.forEach((module, index) => {
    const color = index === centerIndex.value ? '#FFFEF8' : '#A52A2A'
    module.svgMarkup = generateSvgMarkup(module.svgMarkup, color)
  })
})

const coloredSvgs = computed(() => {
  return contactModules.map((module) => module)
})
</script>

<style lang="scss" scoped>
.contact {
  display: flex;
  width: auto;
  height: 31.25rem;
  padding: 2.8125rem 12.1875rem 0.625rem 12.1875rem;
  justify-content: center;
  align-items: center;
  background-color: var(--background-color);

  &-container {
    display: flex;
    width: 65.625rem;
    padding: 2.5rem 0;
    flex-direction: column;
    align-items: center;
    gap: 4.5625rem;

    .contact-title {
      color: var(--secondary-color);
      margin-top: -5.3125rem;
    }

    .rotating-chart {
      display: flex;
      width: 100%;
      height: 18.4375rem;
      justify-content: center;
      align-items: center;
      .slide-content {
        display: flex;
        width: 26rem !important;
        padding: 3.75rem 1.5rem !important;
        flex-direction: column;
        align-items: center;
        background: var(--photo-background);
        gap: 0.9375rem;
        .slide-icon {
          width: 4.5rem;
          height: 4.5rem;
          margin-bottom: 0.4375rem;

          svg {
            width: 100%;
            height: 100%;
          }
        }

        .slide-name {
          color: var(--text-color);
          text-align: center;
        }
      }

      .active-slide {
        display: flex;
        width: 22.5rem;
        padding: 3.75rem 2.5rem;
        flex-direction: column;
        align-items: center;
        background: var(--secondary-color);

        .slide-icon {
          transform: scale(1.1);
          padding-top: 0.3125rem;
        }

        .slide-name {
          transform: scale(1.1);
          color: var(--background-color);
          padding-top: 0.3125rem;
        }
      }
    }
  }
}
@media (max-width: 768px) {
  .contact {
    height: auto;
    padding: 0;

    &-container {
      width: 18rem;
      gap: 0.5rem;

      .contact-title {
        margin-top: 0;
        font-family: Martel;
        font-size: 1.5rem;
        font-style: normal;
        font-weight: 700;
        line-height: 2rem; /* 133.333% */
        letter-spacing: 0.00625rem;
      }

      .rotating-chart {
        padding: 1rem 0 !important;

        .slide-content {
          width: 20rem !important;
          height: 14.25rem;
          justify-content: space-evenly;

          .slide-icon {
            transform: scale(0.8);
          }
        }

        .active-slide {
          display: flex;

          .slide-icon {
            transform: scale(0.8);
            padding-top: 0rem;
          }

          .slide-name {
            display: flex;
            max-width: 15rem;
            flex-wrap: wrap;
          }
        }
      }
    }
  }
}
</style>
